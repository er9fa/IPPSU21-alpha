<!DOCTYPE html>
<html>
  <head>
    <%- include('../partials/header.ejs') %>
    <title>Crypto Calc</title>
    <link rel="stylesheet" href="stylesheets/al-bio-css.css">
    <!-- Scrolling bar library; Source: https://github.com/tjenkinson/dynamic-marquee -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/dynamic-marquee@2"></script>
    <!-- My crypto API -->
    <script src="/data/cryptoAPI.js"></script>
    <link rel="stylesheet" type="text/css" href="stylesheets/mainpage.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
  </head>
  <style>
  @import url(https://fonts.googleapis.com/css?family=Exo+2:200i);
  :root {
  /* Base font size */
  font-size: 3px;
  /* Set neon color */
  --neon-text-color: #f40;
  --neon-border-color: #08f;
  }
body {
  font-family: 'Exo 2', sans-serif;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #000;
  min-height: 20vh;
  background-image: url('https://i.imgur.com/WJFzrOG.png');
  }
h1 {
  font-size: 13rem;
  font-weight: 200;
  font-style: italic;
  color: #fff;
  padding: 4rem 6rem 5.5rem;
  border: 0.4rem solid #fff;
  border-radius: 2rem;
  text-transform: uppercase;
  animation: flicker 1.5s infinite alternate;
  position: absolute;
  top: 40px;
}

h1::-moz-selection {
  background-color: var(--neon-border-color);
  color: var(--neon-text-color);
}

h1::selection {
  background-color: var(--neon-border-color);
  color: var(--neon-text-color);
}

h1:focus {
  outline: none;
}

/* Animate neon flicker */
@keyframes flicker {

    0%, 19%, 21%, 23%, 25%, 54%, 56%, 100% {

        text-shadow:
            -0.2rem -0.2rem 1rem #fff,
            0.2rem 0.2rem 1rem #fff,
            0 0 2rem var(--neon-text-color),
            0 0 4rem var(--neon-text-color),
            0 0 6rem var(--neon-text-color),
            0 0 8rem var(--neon-text-color),
            0 0 10rem var(--neon-text-color);

        box-shadow:
            0 0 .5rem #fff,
            inset 0 0 .5rem #fff,
            0 0 2rem var(--neon-border-color),
            inset 0 0 2rem var(--neon-border-color),
            0 0 4rem var(--neon-border-color),
            inset 0 0 4rem var(--neon-border-color);
    }

    20%, 24%, 55% {
        text-shadow: none;
        box-shadow: none;
    }
}
  form{
    text-shadow: -0.2rem -0.2rem 1rem #fff,
    0.2rem 0.2rem 1rem #fff,
    0 0 2rem var(--neon-text-color),
    0 0 4rem var(--neon-text-color),
    0 0 6rem var(--neon-text-color),
    0 0 8rem var(--neon-text-color),
    0 0 10rem var(--neon-text-color);
    color: white;
    position: absolute;
    top: 300px;
    left: 400px;
  }
  input[type = text]{
    color: black;
  }
  table{
    text-shadow: -0.2rem -0.2rem 1rem #fff,
    0.2rem 0.2rem 1rem #fff,
    0 0 2rem var(--neon-border-color),
    0 0 4rem var(--neon-border-color),
    0 0 6rem var(--neon-border-color),
    0 0 8rem var(--neon-border-color),
    0 0 10rem var(--neon-border-color);
    width: 550px;
    color: white;
    position: absolute;
    top: 375px
  }
.dropbtn {
  background-color: var(--neon-border-color);
  color: var(--neon-text-color);
  font-size: 5rem;
  font-weight: 200;
  font-style: italic;
  color: #fff;
  padding: 4rem 6rem 5.5rem;
  border: 0.4rem solid #fff;
  border-radius: 2rem;
  text-transform: uppercase;
    position: absolute;
    top: 210px;
    right: 550px;
    border: none;
    cursor: pointer;
  }
.dropbtn:hover, .dropbtn:focus {
  background-color: #2980B9;
}
.dropdown {
  position: relative;
  display: inline-block;
}
.dropdown-content {
  display: none;
  position: absolute;
  top: 260px;
  right: 450px;
  background-color: #f1f1f1;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}
.dropdown-content a:hover {background-color: #ddd}
.show {display:block;}

.button{
  background-color: var(--neon-border-color);
  color: var(--neon-text-color);
  font-size: 5rem;
  font-weight: 200;
  font-style: italic;
  color: #fff;
  padding: 4rem 6rem 5.5rem;
  border: 0.4rem solid #fff;
  border-radius: 2rem;
  text-transform: uppercase;
}
.left-button {
  position: absolute;
  top: 230%;
  left: 33%;
}
.right-button {
  position: absolute;
  top: 230%;
  right: 33%;
}
.button:hover, .button:focus {
  background-color: #2980B9;
}

a:link {
  text-shadow: -0.2rem -0.2rem 1rem #fff,
  0.2rem 0.2rem 1rem #fff,
  0 0 2rem var(--neon-text-color),
  0 0 4rem var(--neon-text-color),
  0 0 6rem var(--neon-text-color),
  0 0 8rem var(--neon-text-color),
  0 0 10rem var(--neon-text-color);
  color: white;
}
a:visited {
  text-shadow: none;
  color: white;
}
a:hover {
  color: var(--neon-text-color);
  background-color: transparent;
  text-decoration: underline;
}
a:active {
  color: var(--neon-text-color);
  background-color: transparent;
}

ul {
  border: 2px solid white;
  border-radius: 5px;
  list-style-type: none;
  text-align: center;
  margin: 16em 8em 12em 8em;
  padding-left: 0em;
  box-shadow: 0 0 .5rem #fff,
  inset 0 0 .5rem #fff,
  0 0 2rem var(--neon-border-color),
  inset 0 0 2rem var(--neon-border-color),
  0 0 4rem var(--neon-border-color),
  inset 0 0 4rem var(--neon-border-color);
}

li {
  border-bottom: 2px solid white;
  padding-bottom: 2em;
  box-shadow: 0 0 .5rem #fff,
  inset 0 0 .5rem #fff,
  0 0 2rem var(--neon-border-color),
  inset 0 0 2rem var(--neon-border-color),
  0 0 4rem var(--neon-border-color),
  inset 0 0 4rem var(--neon-border-color);
  background-color: #141d26;
}

li:last-child {
  border-bottom: none;
}

p {
  color: white;
}

article {
  padding: 4em 2em;
  text-align: left;
}

  </style>
  <body>
      <h1 contenteditable spellcheck="false">Crypto News</h1>
      <ul>
        <li>
          <article>
            <h5><a id="title_0" href="" target="_blank"></a></h5>
            <p><img id="image_0" style="float: left; padding-right: 1em" src="" onerror="this.src='https://www.flexx.co/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png'" width="auto" height="100"/></p>
            <p id="preview_0"></p>
          </article>
        </li>
        <li>
          <article>
            <h5><a id="title_1" href="" target="_blank"></a></h5>
            <p><img id="image_1" style="float: left; padding-right: 1em" src="" onerror="this.src='https://www.flexx.co/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png'" width="auto" height="100"/></p>
            <p id="preview_1"></p>
          </article>
        </li>
        <li>
          <article>
            <h5><a id="title_2" href="" target="_blank"></a></h5>
            <p><img id="image_2" style="float: left; padding-right: 1em" src="" onerror="this.src='https://www.flexx.co/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png'" width="auto" height="100"/></p>
            <p id="preview_2"></p>
          </article>
        </li>
        <li>
          <article>
            <h5><a id="title_3" href="" target="_blank"></a></h5>
            <p><img id="image_3" style="float: left; padding-right: 1em" src="" onerror="this.src='https://www.flexx.co/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png'" width="auto" height="100"/></p>
            <p id="preview_3"></p>
          </article>
        </li>
        <li>
          <article>
            <h5><a id="title_4" href="" target="_blank"></a></h5>
            <p><img id="image_4" style="float: left; padding-right: 1em" src="" onerror="this.src='https://www.flexx.co/assets/camaleon_cms/image-not-found-4a963b95bf081c3ea02923dceaeb3f8085e1a654fc54840aac61a57a60903fef.png'" width="auto" height="100"/></p>
            <p id="preview_4"></p>
          </article>
        </li>
      </ul>
      <div>
        <button onclick="leftClicked()" class= "button left-button">Prev.</button>
        <button onclick="rightClicked()" class= "button right-button">Next</button>
      </div>

      <div id="marquee"></div>

      <input type="checkbox" id="check">
      <header>
        <label for="check">
          <i class="fas fa-bars" id="sidebar_btn"></i>
        </label>
        <div class="left_area">
          <h3>Main</h3>
        </div>
        <div class="right_area">
        <div>
      </header>

      <div class="sidebar">
        <center>
          <img src = "https://i.ibb.co/G9CVPYh/bitcoin-dd8a16.png" class="profile_image" alt = "">
          <h4>Crypto Calc</h4>
        </center>
        <a href="/"><i class="fas fa-coins"><span> Main</span></i></a>
        <a href="/calculator"><i class="fas fa-calculator"><span> Calculator</span></i></a>
        <a href="/news"><i class="fas fa-newspaper"><span> News</span></i></a>
        <a href="/database"><i class="fas fa-database"><span> Database</span></i></a>
        <a href="/game"><i class="fas fa-gamepad"><span> Game</span></i></a>
      </div>

  </body>
  <script>

  var page_num = 1;

  var i = 0;

  fetch("https://newsapi.org/v2/everything?apiKey=a791d1a1c2674ac8914503c53d9a1e8b&language=en&q=bitcoin&page=" + page_num).then(r => r.json()).then(data => {
      var num_articles = data.totalResults;
      console.log(num_articles + " articles found");

      document.getElementById("title_0").innerHTML = data.articles[i].title;
      document.getElementById("title_0").href = data.articles[i].url;
      document.getElementById("image_0").src = data.articles[i].urlToImage;
      document.getElementById("preview_0").innerHTML = data.articles[i].content.substring(0, 200);

      document.getElementById("title_1").innerHTML = data.articles[i+1].title;
      document.getElementById("title_1").href = data.articles[i+1].url;
      document.getElementById("image_1").src = data.articles[i+1].urlToImage;
      document.getElementById("preview_1").innerHTML = data.articles[i+1].content.substring(0, 200);

      document.getElementById("title_2").innerHTML = data.articles[i+2].title;
      document.getElementById("title_2").href = data.articles[i+2].url;
      document.getElementById("image_2").src = data.articles[i+2].urlToImage;
      document.getElementById("preview_2").innerHTML = data.articles[i+2].content.substring(0, 200);

      document.getElementById("title_3").innerHTML = data.articles[i+3].title;
      document.getElementById("title_3").href = data.articles[i+3].url;
      document.getElementById("image_3").src = data.articles[i+3].urlToImage;
      document.getElementById("preview_3").innerHTML = data.articles[i+3].content.substring(0, 200);

      document.getElementById("title_4").innerHTML = data.articles[i+4].title;
      document.getElementById("title_4").href = data.articles[i+4].url;
      document.getElementById("image_4").src = data.articles[i+4].urlToImage;
      document.getElementById("preview_4").innerHTML = data.articles[i+4].content.substring(0, 200);
  })

  function leftClicked() {
    if (i === 0) {
      page_num--;
      i = 15;
    }
    else {
      i -= 5;
    }
    fetch("https://newsapi.org/v2/everything?apiKey=a791d1a1c2674ac8914503c53d9a1e8b&language=en&q=bitcoin&page=" + page_num).then(r => r.json()).then(data => {
        var num_articles = data.totalResults;
        console.log(num_articles + " articles found");

        document.getElementById("title_0").innerHTML = data.articles[i].title;
        document.getElementById("title_0").href = data.articles[i].url;
        document.getElementById("image_0").src = data.articles[i].urlToImage;
        document.getElementById("preview_0").innerHTML = data.articles[i].content.substring(0, 200);

        document.getElementById("title_1").innerHTML = data.articles[i+1].title;
        document.getElementById("title_1").href = data.articles[i+1].url;
        document.getElementById("image_1").src = data.articles[i+1].urlToImage;
        document.getElementById("preview_1").innerHTML = data.articles[i+1].content.substring(0, 200);

        document.getElementById("title_2").innerHTML = data.articles[i+2].title;
        document.getElementById("title_2").href = data.articles[i+2].url;
        document.getElementById("image_2").src = data.articles[i+2].urlToImage;
        document.getElementById("preview_2").innerHTML = data.articles[i+2].content.substring(0, 200);

        document.getElementById("title_3").innerHTML = data.articles[i+3].title;
        document.getElementById("title_3").href = data.articles[i+3].url;
        document.getElementById("image_3").src = data.articles[i+3].urlToImage;
        document.getElementById("preview_3").innerHTML = data.articles[i+3].content.substring(0, 200);

        document.getElementById("title_4").innerHTML = data.articles[i+4].title;
        document.getElementById("title_4").href = data.articles[i+4].url;
        document.getElementById("image_4").src = data.articles[i+4].urlToImage;
        document.getElementById("preview_4").innerHTML = data.articles[i+4].content.substring(0, 200);
    })
  }

  function rightClicked() {
    if (i === 15) {
      page_num++;
      i = 0;
    }
    else {
      i += 5;
    }
    fetch("https://newsapi.org/v2/everything?apiKey=a791d1a1c2674ac8914503c53d9a1e8b&language=en&q=bitcoin&page=" + page_num).then(r => r.json()).then(data => {
        var num_articles = data.totalResults;
        console.log(num_articles + " articles found");

        document.getElementById("title_0").innerHTML = data.articles[i].title;
        document.getElementById("title_0").href = data.articles[i].url;
        document.getElementById("image_0").src = data.articles[i].urlToImage;
        document.getElementById("preview_0").innerHTML = data.articles[i].content.substring(0, 200);

        document.getElementById("title_1").innerHTML = data.articles[i+1].title;
        document.getElementById("title_1").href = data.articles[i+1].url;
        document.getElementById("image_1").src = data.articles[i+1].urlToImage;
        document.getElementById("preview_1").innerHTML = data.articles[i+1].content.substring(0, 200);

        document.getElementById("title_2").innerHTML = data.articles[i+2].title;
        document.getElementById("title_2").href = data.articles[i+2].url;
        document.getElementById("image_2").src = data.articles[i+2].urlToImage;
        document.getElementById("preview_2").innerHTML = data.articles[i+2].content.substring(0, 200);

        document.getElementById("title_3").innerHTML = data.articles[i+3].title;
        document.getElementById("title_3").href = data.articles[i+3].url;
        document.getElementById("image_3").src = data.articles[i+3].urlToImage;
        document.getElementById("preview_3").innerHTML = data.articles[i+3].content.substring(0, 200);

        document.getElementById("title_4").innerHTML = data.articles[i+4].title;
        document.getElementById("title_4").href = data.articles[i+4].url;
        document.getElementById("image_4").src = data.articles[i+4].urlToImage;
        document.getElementById("preview_4").innerHTML = data.articles[i+4].content.substring(0, 200);
    })
  }

  // Initialize scrolling bar
  const Marquee = dynamicMarquee.Marquee;
  const marquee = new Marquee(document.getElementById('marquee'), {
      // Move words 100px/s to the left
      rate: -100
  })

  // Concat popular coins to scrolling bar
  getPopularCoins().then(coins => {
      let popularCoins = ""
      coins.forEach(coin => {
          const tickerSymbol = coin["symbol"]
          const price = coin.current_price.toFixed(2)
          const priceChange = coin.price_change_24h
          const hasPriceIncreased = (priceChange >= 0) ? "↑" : "↓"

          const result = hasPriceIncreased + " " + tickerSymbol + " $" + price + "\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"

          popularCoins += result
      })

      // Add popular coins to scrolling bar
      // For looping infinitely, the dynamicMarquee library
      //      uses an array of functions which return strings or elements to iterate through
      // TODO: What is "window.l"?
      window.l = dynamicMarquee.loop(marquee, [
      () => popularCoins
  ])
  })
// Close the dropdown menu if the user clicks outside of it
  </script>
</html>
